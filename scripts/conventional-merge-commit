#!/bin/sh
# prepare-commit-msg:
# rewrite auto-generated merge messages to conventional commit format

commit_source=${2-}
[ "$commit_source" = "merge" ] || exit 0

# shellcheck source=lib/commit-msg.sh disable=SC1091
. "$(dirname "$0")/lib/commit-msg.sh"

commit_msg_file="$1"

# Read and parse commit message
read_commit_msg "$commit_msg_file"

# Check if first line matches merge pattern (case-insensitive)
# Matches: "Merge ...", "merge ...", "Merge", "merge"
# Does NOT match: "Merges...", "merges...", "merging..."
case "$COMMIT_FIRST_LINE" in
Merge\ *)
	rest="${COMMIT_FIRST_LINE#Merge }"
	new_first_line="chore: merge $rest"
	;;
merge\ *)
	rest="${COMMIT_FIRST_LINE#merge }"
	new_first_line="chore: merge $rest"
	;;
Merge | merge)
	new_first_line="chore: merge"
	;;
*)
	exit 0
	;;
esac
write_commit_msg "$commit_msg_file" "$new_first_line" "$COMMIT_REST"
